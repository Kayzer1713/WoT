
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">

    <title>WOT</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/style.css">
  </head>
  <body onload="init()">
    <header>
  <div class="collapse bg-dark" id="navbarHeader">
    <div class="container">
      <div class="row">
        <div class="col-sm-8 col-md-7 py-4">
          <h4 class="text-white">About</h4>
          <p class="text-muted">Blab bla bla bla bla</p>
        </div>
        <div class="col-sm-4 offset-md-1 py-4">
          <h4 class="text-white">Contact</h4>

        </div>
      </div>
    </div>
  </div>
  <div class="navbar navbar-dark bg-dark shadow-sm">
    <div class="container d-flex justify-content-between">
      <a href="#" class="navbar-brand d-flex align-items-center">
          <strong>WOT · Aide notre planète</strong>
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarHeader" aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
    </div>
  </div>
</header>

<main role="main">



  <div class="album py-5 bg-light" id="main">
    <div class="container">
      <div class="row">
        <div class="col-md-10"
          <form class="form-inline ">
            <input class="form-control" type="search" placeholder="Rechercher" aria-label="Search">
          </form>
        </div>
        <div class="col-md-2">
          <button type="button" name="button"  class="btn btn-primary" onclick="ajoutAction()">Proposer Action </button>
        </diV>
      </div>
      <br/>
      <br/>
      <br/>
      <div class="row">
        <div class="col-md-4 ">
          <div class="card mb-4 shadow-sm art">
            <h1>
              Plage Gruisan
            </h1
            <p>
              Bla bla bla bla bla bla bla bla
            </p>
            <br/>
            <p> Lieu : </p>
            <br/>
            <p> Météo requise : Soleil </p>
            <br/>
            <p>
              Météo Prévisinnelle
            </p>
            <br/>
            <p> Auteur : Baptiste Salvador </p>
            <button type="button" name="button" class="btn btn-light">Rejoindre</button>
            </div>
          </div>

        <div class="col-md-4">
          <div class="card mb-4 shadow-sm art">
            <h1>
              Plage Mortbillan
            </h1
            <p>
              Bla bla bla bla bla bla bla bla
            </p>
            <br/>
            <p> Lieu : </p>
            <br/>
            <p> Météo requise : Peut-importe </p>
            <br/>
            <p>
              Météo Prévisinnelle
            </p>
            <br/>
            <p> Auteur : Baptiste Salvador </p>
            <button type="button" name="button" class="btn btn-light">Rejoindre</button>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card mb-4 shadow-sm art">
            <h1>
              Cathédrale Albi
            </h1
            <p>
              Bla bla bla bla bla bla bla bla
            </p>
            <br/>
            <p> Lieu : </p>
            <br/>
            <p> Météo requise : Peut-importe </p>
            <br/>
            <p>
              Météo Prévisinnelle
            </p>
            <br/>
            <p> Auteur : Baptiste Salvador </p>
            <button type="button" name="button" class="btn btn-light">Rejoindre</button>
          </div>
        </div>


      </div>
    </div>
  </div>
  <div class="album py-5 bg-light" id="addAction">
    <div class="container">
      <div class="row">
        <div class="col-md-10">
          <form>
            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="inputEmail4">Titre</label>
                <input type="text" class="form-control" id="Titre" placeholder="Titre">
              </div>
            </div>
            <div class="form-group">
              <label for="inputAddress">Description</label>
              <textarea type="text" class="form-control" id="inputAddress" placeholder="Description de la mission....."></textarea>
            </div>
            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="lieu">Lieu</label>
                <input type="text" class="form-control" id="lieu">
              </div>
              <!--pour les values https://openweathermap.org/weather-conditions-->
              <div class="form-group col-md-6">
                <label for="inputState">Météo requise</label>
                <select id="inputState" class="form-control">
                  <option selected>Tout les temps</option>
                  <option value="800">Temps clair</option>
                  <option value="801">Temps clair ou nuageux</option>
                  <option value="500">Pluie</option>
                  <option value="600">Neige</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="gridCheck">
                <label class="form-check-label" for="gridCheck">
                  Y participer
                </label>
              </div>
            </div>
            <button onclick="retourMain()" class="btn btn-secondary">retour</button>
            <button type="submit" class="btn btn-primary">Sign in</button>
          </form>
        </div>
      </div>
    </div>
  </div>

</main>

<footer class="text-muted">
  <div class="container">
    <div class="row">
      <div class="col-md-6 offset-md-3">
        <div id="log"></div>
            <p class="float-right">
              <a href="#">Retour en haut</a>
            </p>
            <p>Kévin Nguyen | Baptiste Salvador | Ghislain Vidal</p>
      </div>
    </div>
    <div class="row">
    <br/>
    <div class="col-md-12">
      <div class="city-icon">
      <div class="city-icon-holder">
      <div id="city-name"></div>
      <img src="" alt="" id="icon">
        </div>
    </div>
    <div id="test1"></div>
    <div id="test2"></div>
  </div>
</div>
</div>


</script>
</footer>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js" integrity="sha384-xrRywqdh3PHs8keKZN+8zzc5TX0GRTLCcmivcbNJWm2rs5C8PRhcEn3czEjhAO9o" crossorigin="anonymous"></script>
</body>
</html>

<script>
var socket;

let latitude,longitude,city;


function init(){
  var host = "ws://127.0.0.1:1337";
  try{

    getLocation();
    socket = new WebSocket(host);
    log('WebSocket - status '+socket.readyState);
    socket.onopen    = function(msg){ log("Welcome - status "+this.readyState); };
    socket.onmessage = function(event) {
      var msg = JSON.parse(event.data);
      //var time = new Date(msg.date);
      //var timeStr = time.toLocaleTimeString();

        if(msg['0'].Mail !== null)
        {
            //log('test: '+ msg['0'].Mail);
        }

      }
    socket.onclose   = function(msg){ log("Disconnected - status "+this.readyState); };

  }
  catch(ex){ log(ex); }
  //$("msg").focus();

}

function send(){
  var txt,msg;
  txt = $("msg");
  msg = txt.value;
  if(!msg){ alert("Message can not be empty"); return; }
  txt.value="";
  txt.focus();
  try{ socket.send(msg); log('Sent: '+msg); } catch(ex){ log(ex); }
}
function ajoutAction() {
  var user, Nom;
  user = "test";
  Nom= user;
  try{socket.send("addAction"); log('Sent: ajout action au nom de '+ Nom);
  $("main").style.display = 'none';
  $("addAction").style.display = 'inherit';
  } catch(ex){ log(ex); }
  $("lieu").setAttribute("placeholder",city);
}
function retourMain() {
  $("addAction").style.display = 'none';
  $("main").style.display = 'inherit';

}
function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition);
  } else {
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function showPosition(position) {
  latitude = position.coords.latitude;
  longitude=  position.coords.longitude;
  findWeatherDetails();
}

function quit(){
  log("Goodbye!");
  socket.close();
  socket=null;
}

// Utilities
function $(id){ return document.getElementById(id); }
function log(msg){ $("log").innerHTML+="<br>"+msg; }
function onkey(event){ if(event.keyCode==13){ send(); } }

//Utilisation API METEO lien doc : https://openweathermap.org/forecast5

let test1 = document.getElementById("test1");
let test2 = document.getElementById("test2");
let icon = document.getElementById("icon");

const appKey = "5d2adabab648a8786abe5480fc06a5df";



function findWeatherDetails() {
  let searchLink = "https://api.openweathermap.org/data/2.5/forecast?lat="+latitude+"&lon="+longitude+"&appid="+appKey;
   httpRequestAsync(searchLink, theResponse);
 }

function theResponse(response) {
  let jsonObject = JSON.parse(response);
  test1.innerHTML = parseInt(jsonObject.list[0].main.temp - 273) + "°";
  city = jsonObject.city.name ;
  test2.innerHTML = city;
  icon.src = "http://openweathermap.org/img/w/" + jsonObject.list[0].weather[0].icon + ".png";

}

function httpRequestAsync(url, callback)
{
  console.log("hello");
    var httpRequest = new XMLHttpRequest();
    httpRequest.onreadystatechange = () => {
        if (httpRequest.readyState == 4 && httpRequest.status == 200)
            callback(httpRequest.responseText);
    }
    httpRequest.open("GET", url, true); // true for asynchronous
    httpRequest.send();
}
</script>
